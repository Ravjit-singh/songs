<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Musicfy ‚Äî Mood Player</title>

  <!-- Poppins Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0a0f14;
      --bg-2:#0b1118;
      --muted:#9aa3ad;
      --text:#eaf3f6;
      --accent:#1DB954;
      --surface:rgba(255,255,255,0.03);
      --shadow: 0 12px 30px rgba(2,6,23,0.55);
      --radius:14px;
      --blur: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Poppins',sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 80% -10%, rgba(29,185,84,0.12), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
      -webkit-tap-highlight-color: transparent;
    }

    .app{min-height:100vh;display:flex;flex-direction:column;gap:14px;padding:14px;max-width:920px;margin:0 auto}

    header{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#66d37a);display:grid;place-items:center;font-weight:800;color:#04120a;box-shadow:0 8px 24px rgba(29,185,84,0.25)}
    .title{font-weight:700;font-size:18px;letter-spacing:.3px}
    .subtitle{font-size:12px;color:var(--muted)}

    /* Hero Section */
    .hero{
      position:relative;
      display:flex;
      gap:14px;
      align-items:center;
      padding:14px;
      border-radius:var(--radius);
      background:linear-gradient(135deg, rgba(29,185,84,0.18), rgba(255,255,255,0.03));
      box-shadow:var(--shadow);
      overflow:hidden;
      isolation:isolate;
    }

    /* Vibrant background like Spotify */
    .hero::before {
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 20% 40%, rgba(29,185,84,0.4), transparent 60%),
                 radial-gradient(circle at 80% 20%, rgba(255,70,150,0.35), transparent 60%),
                 radial-gradient(circle at 50% 80%, rgba(80,150,255,0.35), transparent 60%);
      filter:blur(90px);
      z-index:-1;
    }

    .cover{
      width:90px;height:90px;min-width:90px;
      border-radius:16px;
      background:linear-gradient(135deg,#4a2fd6,#1db954);
      display:grid;place-items:center;font-weight:800;font-size:24px;
      box-shadow:0 10px 28px rgba(0,0,0,.35), 0 6px 18px rgba(29,185,84,.18) inset;
      transform:translateZ(0);
    }

    /* Mood row with vibrant cards */
    .moods-wrap{margin-top:8px}
    .moods{
      display:flex; gap:14px; overflow-x:auto; padding:4px 2px 12px;
      scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
    }
    .moods::-webkit-scrollbar{display:none}

    /* Mood Cards */
    .mood-card{
      scroll-snap-align:start;
      min-width:140px; max-width:150px; aspect-ratio:1.6/1;
      border-radius:18px; 
      padding:14px;
      font-family:'Poppins',sans-serif;
      font-weight:600;
      font-size:15px;
      letter-spacing:0.3px;
      color:#fff;
      background:linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.03));
      backdrop-filter:blur(18px) saturate(140%);
      position:relative;
      overflow:hidden;
      cursor:pointer;
      box-shadow:0 6px 20px rgba(0,0,0,.35);
      transition:transform .25s ease, box-shadow .25s ease, background .25s ease;
      will-change:transform;
    }

    /* Vibrant gradients for each mood */
    .mood-card[data-mood="chill"]{background:linear-gradient(135deg,#1db954,#0f766e);}
    .mood-card[data-mood="gym"]{background:linear-gradient(135deg,#ff5a4d,#c41e3a);}
    .mood-card[data-mood="love"]{background:linear-gradient(135deg,#ff4da6,#a0215d);}
    .mood-card[data-mood="sad"]{background:linear-gradient(135deg,#4a7dff,#24336b);}

    /* Animation effects */
    .mood-card:hover{transform:translateY(-4px) scale(1.03);box-shadow:0 10px 24px rgba(0,0,0,.4)}
    .mood-card:active{transform:translateY(1px) scale(0.97)}

    /* Playlist Panel */
    .playlist-panel{margin-top:8px;background:rgba(255,255,255,0.02);border-radius:12px;padding:8px;box-shadow:var(--shadow)}
    .panel-header{display:flex;justify-content:space-between;align-items:center;padding:6px 8px}
    .panel-controls{display:flex;gap:8px;align-items:center}
    .btn{background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer; line-height:1;padding:6px;border-radius:10px}
    .btn:active{transform:scale(.96)}
    .btn.toggle.active{color:var(--accent)}
    .song-list{max-height:44vh;overflow:auto;padding:6px}
    .song-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:12px;gap:8px;cursor:pointer;transition:background .18s ease, transform .18s ease;}
    .song-item:hover{background:rgba(255,255,255,.03)}
    .song-item.playing{background:linear-gradient(90deg, rgba(29,185,84,0.10), rgba(255,255,255,0.02))}
    .song-left{display:flex;gap:10px;align-items:center;min-width:0}
    .song-thumb{width:48px;height:48px;border-radius:10px;background:rgba(255,255,255,0.05);display:grid;place-items:center;font-weight:700}
    .song-meta{min-width:0;overflow:hidden}
    .song-title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .song-sub{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    /* Player */
    .player{
      margin-top:12px;background:linear-gradient(90deg, rgba(8,10,12,0.99), rgba(18,20,22,0.98));
      border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;box-shadow:var(--shadow)
    }
    .player-top{display:flex;align-items:center;gap:12px}
    .player-thumb{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#ffb86b,#7b61ff);display:grid;place-items:center;font-weight:800}
    .now-title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .now-sub{font-size:12px;color:var(--muted)}

    /* Modern Play Button with CSS-only Icon */
    .play-large {
      width: 64px; height: 64px; border-radius: 50%; background: var(--accent);
      display:grid; place-items:center; border:0; cursor:pointer;
      box-shadow: 0 8px 24px rgba(29,185,84,0.28);
      position:relative; transition: transform .18s ease;
      will-change:transform;
    }
    .play-large::before{
      content:""; position:absolute; width:0; height:0;
      border-left: 20px solid #04120a; border-top: 12px solid transparent; border-bottom: 12px solid transparent;
      transition: all .25s ease;
    }
    .play-large[data-state="pause"]::before{
      border:none; width:18px; height:20px;
      background: linear-gradient(to right, #04120a 7px, transparent 7px, transparent 11px, #04120a 11px);
      background-size:18px 20px;
    }

    .ctrl-row{display:flex;align-items:center;gap:18px;justify-content:center}
    .progress-row{display:flex;align-items:center;gap:8px;width:100%}
    .time{font-size:12px;color:var(--muted);min-width:36px;text-align:center}
    .progress{flex:1;height:6px;background:rgba(255,255,255,0.06);border-radius:999px;position:relative;cursor:pointer}
    .progress>i{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--accent),#5ec86b);border-radius:999px}

    .visualizer{height:54px;width:100%;border-radius:12px;overflow:hidden;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center}
    canvas#audioCanvas{width:100%;height:54px;display:block}
  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header>
      <div class="logo">‚ô™</div>
      <div>
        <div class="title">R Music</div>
        <div class="subtitle">Mood player with visualizer</div>
      </div>
    </header>

    <!-- HERO + MOODS -->
    <div class="hero">
      <div class="cover">üî•</div>
      <div style="min-width:0">
        <h2 id="heroTitle" style="margin:0 0 2px 0">Pick a mood</h2>
        <div id="heroDesc" class="subtitle">Tap a mood to load songs</div>

        <!-- Vibrant Mood Row -->
        <div class="moods-wrap">
          <div class="moods">
            <button class="mood-card" data-mood="chill">Chill</button>
            <button class="mood-card" data-mood="gym">Gym</button>
            <button class="mood-card" data-mood="love">Love</button>
            <button class="mood-card" data-mood="sad">Sad</button>
          </div>
        </div>
      </div>
    </div>

    <!-- PLAYER -->
    <div class="player">
      <div class="player-top">
        <div class="player-thumb" id="playerThumb">‚ô™</div>
        <div style="min-width:0">
          <div class="now-title" id="nowTitle">No song loaded</div>
          <div class="now-sub" id="nowSub">‚Äî</div>
        </div>
      </div>

      <div class="controls">
        <div class="ctrl-row">
          <button class="btn" id="prevBtn" aria-label="Previous">‚èÆ</button>
          <button class="play-large" id="playBtn" data-state="play" aria-label="Play/Pause"></button>
          <button class="btn" id="nextBtn" aria-label="Next">‚è≠</button>
        </div>

        <div class="progress-row">
          <div class="time" id="curTime">0:00</div>
          <div class="progress" id="progress"><i></i></div>
          <div class="time" id="durTime">0:00</div>
        </div>

        <div class="visualizer">
          <canvas id="audioCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- PLAYLIST PANEL -->
    <div class="playlist-panel">
      <div class="panel-header">
        <div>
          <div style="font-weight:700" id="playlistTitle">Playlist</div>
          <div id="playlistCount" class="subtitle">Select a mood</div>
        </div>
        <div class="panel-controls">
          <button class="btn toggle" id="shuffleBtn">üîÄ</button>
          <button class="btn toggle" id="repeatBtn">üîÅ</button>
          <button class="btn" id="refreshBtn">‚ü≥</button>
        </div>
      </div>
      <div class="song-list" id="songList">
        <div style="padding:12px;color:var(--muted)">No mood selected</div>
      </div>
    </div>
  </div>

  <!-- AUDIO ELEMENT -->
  <audio id="audio" crossorigin="anonymous"></audio>

  <!-- JAVASCRIPT -->
  <script>
    const apiKey = "AIzaSyBTxQN4N7JTQpleidOMFyq1znQERnrxb0Y"; // replace with your own key
    const folders = {
      chill: "1BGR4bsLSq5u4IrGdrJDMhMlREnn_9mmt",
      gym:   "1rMp0XEcEk47MKCw8UgWLgts0RHXkG596",
      love:  "1uQHnqzcadvYgeuZgaiCB1DrFpc3fkgl2",
      sad:   "1rM170DqllxmiZvtSBtxfewBwPyxNb99B"
    };

    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const curTimeEl = document.getElementById('curTime');
    const durTimeEl = document.getElementById('durTime');
    const progressEl = document.getElementById('progress');
    const progressFillEl = progressEl.querySelector('i');
    const nowTitle = document.getElementById('nowTitle');
    const nowSub = document.getElementById('nowSub');
    const playerThumb = document.getElementById('playerThumb');
    const songListEl = document.getElementById('songList');
    const playlistTitle = document.getElementById('playlistTitle');
    const playlistCount = document.getElementById('playlistCount');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const repeatBtn = document.getElementById('repeatBtn');

    let playlist = [];
    let currentIndex = -1;
    let isPlaying = false;
    let shuffle = false;
    let repeat = false;
    let currentMood = null;

    function formatTime(s){ 
      if(!s||isNaN(s)) return "0:00"; 
      const m=Math.floor(s/60); 
      const sec=Math.floor(s%60).toString().padStart(2,'0'); 
      return m+":"+sec; 
    }

    function renderPlaylist(){
      songListEl.innerHTML = "";
      if(!playlist.length){
        songListEl.innerHTML="<div style='padding:12px;color:#9aa3ad'>No songs</div>";
        playlistCount.textContent="0 songs"; 
        return;
      }
      playlistCount.textContent = playlist.length+" songs";
      playlist.forEach((s,i)=>{
        const item=document.createElement("div");
        item.className="song-item"+(i===currentIndex?" playing":"");
        item.innerHTML=`<div class="song-left">
            <div class="song-thumb">${i+1}</div>
            <div class="song-meta">
              <div class="song-title">${s.name}</div>
              <div class="song-sub"></div>
            </div>
          </div>`;
        item.addEventListener("click",()=>playByIndex(i));
        songListEl.appendChild(item);
      });
    }

    async function loadMood(mood){
      currentMood=mood;
      playlistTitle.textContent=mood.charAt(0).toUpperCase()+mood.slice(1);
      playlistCount.textContent="Loading...";
      songListEl.innerHTML="<div style='padding:12px;color:#9aa3ad'>Fetching songs...</div>";
      const url=`https://www.googleapis.com/drive/v3/files?q='${folders[mood]}'+in+parents&key=${apiKey}&fields=files(id,name,mimeType)`;
      const res=await fetch(url); 
      const data=await res.json();
      playlist=data.files.map(f=>({id:f.id,name:f.name,mimeType:f.mimeType,url:`https://www.googleapis.com/drive/v3/files/${f.id}?alt=media&key=${apiKey}`}));
      currentIndex=-1; 
      renderPlaylist();  
      if(playlist.length) playByIndex(0);
      }
      
      function playByIndex(i){
      if(i<0 || i>=playlist.length) return;
      currentIndex=i;
      const song=playlist[i];
      audio.src=song.url;
      nowTitle.textContent=song.name;
      nowSub.textContent=currentMood.toUpperCase();
      document.querySelectorAll('.song-item').forEach((el,idx)=>{
      el.classList.toggle('playing', idx===i);
      });
      audio.play();
      isPlaying=true;
      playBtn.setAttribute("data-state","pause");
      }
      
      function togglePlay(){
      if(!audio.src) return;
      if(isPlaying){
      audio.pause();
      isPlaying=false;
      playBtn.setAttribute("data-state","play");
      } else {
      audio.play();
      isPlaying=true;
      playBtn.setAttribute("data-state","pause");
      }
      }
      
      function playNext(){
      if(shuffle){
      playByIndex(Math.floor(Math.random()*playlist.length));
      } else if(currentIndex<playlist.length-1){
      playByIndex(currentIndex+1);
      } else if(repeat){
      playByIndex(0);
      }
      }
      
      function playPrev(){
      if(currentIndex>0){
      playByIndex(currentIndex-1);
      } else if(repeat){
      playByIndex(playlist.length-1);
      }
      }
      
      playBtn.addEventListener('click', togglePlay);
      nextBtn.addEventListener('click', playNext);
      prevBtn.addEventListener('click', playPrev);
      
      shuffleBtn.addEventListener('click',()=>{
      shuffle=!shuffle;
      shuffleBtn.classList.toggle('active',shuffle);
      });
      
      repeatBtn.addEventListener('click',()=>{
      repeat=!repeat;
      repeatBtn.classList.toggle('active',repeat);
      });
      
      progressEl.addEventListener('click',(e)=>{
      if(!audio.duration) return;
      const pct=e.offsetX/progressEl.clientWidth;
      audio.currentTime=pct*audio.duration;
      });
      
      audio.addEventListener('timeupdate',()=>{
      curTimeEl.textContent=formatTime(audio.currentTime);
      durTimeEl.textContent=formatTime(audio.duration);
      const pct=(audio.currentTime/audio.duration)*100;
      progressFillEl.style.width=pct+"%";
      });
      
      audio.addEventListener('ended',playNext);
      
      // Mood card click events
      document.querySelectorAll('.mood-card').forEach(btn=>{
      btn.addEventListener('click',()=>{
      const mood=btn.dataset.mood;
      loadMood(mood);
      });
      });
      
/* ====== WAVEFORM AUDIO VISUALIZER ====== */
const canvas = document.getElementById('audioCanvas');
const ctx = canvas.getContext('2d');

// Create audio context and analyser
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
const source = audioCtx.createMediaElementSource(audio);

source.connect(analyser);
analyser.connect(audioCtx.destination);

// Settings for smooth waveform
analyser.fftSize = 512; // higher = smoother, more fluid wave
const bufferLength = analyser.frequencyBinCount;
const dataArray = new Uint8Array(bufferLength);

let waveOffset = 0; // used for continuous motion

function drawVisualizer() {
  requestAnimationFrame(drawVisualizer);
  analyser.getByteTimeDomainData(dataArray);

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ===== Main Glowing Wave =====
  ctx.lineWidth = 2;
  ctx.strokeStyle = "rgba(29,185,84,1)"; // Spotify Green
  ctx.shadowColor = "rgba(29,185,84,0.9)";
  ctx.shadowBlur = 18;

  ctx.beginPath();

  const sliceWidth = canvas.width / bufferLength;
  let x = 0;

  for (let i = 0; i < bufferLength; i++) {
    const v = dataArray[i] / 128.0; // normalize
    const y = (v * canvas.height) / 2;

    // Smooth bending wave effect
    const waveY = y + Math.sin(x * 0.02 + waveOffset) * 10;

    if (i === 0) {
      ctx.moveTo(x, waveY);
    } else {
      ctx.lineTo(x, waveY);
    }

    x += sliceWidth;
  }

  ctx.lineTo(canvas.width, canvas.height / 2);
  ctx.stroke();

  // ===== Secondary Dim Wave for Depth =====
  ctx.beginPath();
  ctx.lineWidth = 1;
  ctx.strokeStyle = "rgba(29,185,84,0.35)";
  ctx.shadowBlur = 8;

  x = 0;
  for (let i = 0; i < bufferLength; i++) {
    const v = dataArray[i] / 128.0;
    const y = (v * canvas.height) / 2;

    // Smaller oscillation for subtle background layer
    const waveY = y + Math.sin(x * 0.03 + waveOffset * 1.5) * 6;

    if (i === 0) {
      ctx.moveTo(x, waveY);
    } else {
      ctx.lineTo(x, waveY);
    }

    x += sliceWidth;
  }
  ctx.stroke();

  // Smooth motion increment
  waveOffset += 0.05;
}
drawVisualizer();

// Auto-resize canvas
function resizeCanvas() {
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();
      </script>
      </body>
      </html>